<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

    <changeSet id="ugandaemrpoc-2016-08-02-12-21" author="slubwama">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="patient_que_type"/>
            </not>
        </preConditions>
        <comment>
            Creating the patient_que_type table
        </comment>
        <sql>
            create table patient_que_type(
            patient_que_type_id int not null
            primary key,
            name varchar(255) not null,
            description varchar(255) null,
            creator int null,
            date_created datetime null,
            changed_by int null,
            date_changed datetime null,
            voided tinyint(1) null,
            date_voided datetime null,
            voided_by int null,
            void_reason varchar(255) null,
            constraint patient_que_type_name_uindex
            unique (name),
            constraint patient_que_type_users_user_id_fk
            foreign key (creator) references users (user_id),
            constraint patient_que_type_users_user_id_fk1
            foreign key (changed_by) references users (user_id),
            constraint patient_que_type_users_user_id_fk2
            foreign key (voided_by) references users (user_id));
            create index patient_que_type_users_user_id_fk on patient_que_type (creator);
            create index patient_que_type_users_user_id_fk1 on patient_que_type (changed_by);
            create index patient_que_type_users_user_id_fk2 on patient_que_type (voided_by);
        </sql>
    </changeSet>

    <changeSet id="ugandaemrpoc-2018-05-10-17-30" author="slubwama">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="patient_que_type"/>
            <not>
                <tableExists tableName="patient_que"/>
            </not>
        </preConditions>
        <comment>
            Creating the patient_que table
        </comment>
        <sql>
            CREATE TABLE patient_que(patient_que_id INT PRIMARY KEY AUTO_INCREMENT,
            patient_id INT,
            provider_id INT,
            location_from INT,
            location_to INT,
            patient_que_type_id INT,
            status VARCHAR(255),
            date_created DATETIME,
            changed_by INT,
            date_changed DATETIME,
            voided BOOLEAN,
            date_voided DATETIME,
            voided_by INT,
            void_reason VARCHAR(255),
            comment VARCHAR(255),
            creator INT,
            CONSTRAINT patient_que_patient_patient_id_fk FOREIGN KEY (patient_id) REFERENCES patient (patient_id),
            CONSTRAINT patient_que_provider_provider_id_fk FOREIGN KEY (provider_id) REFERENCES provider (provider_id),
            CONSTRAINT patient_que_patient_que_type_patient_que_type_id_fk FOREIGN KEY (patient_que_type_id) REFERENCES
            patient_que_type (patient_que_type_id),
            CONSTRAINT patient_que_location_location_id_fk FOREIGN KEY (location_from) REFERENCES location
            (location_id),
            CONSTRAINT patient_que_location_location_id_fk1 FOREIGN KEY (location_to) REFERENCES location (location_id),
            CONSTRAINT patient_que_users_user_id_fk FOREIGN KEY (creator) REFERENCES users (user_id),
            CONSTRAINT patient_que_users__fk1 FOREIGN KEY (changed_by) REFERENCES users (user_id),
            CONSTRAINT patient_que_users__fk2 FOREIGN KEY (voided_by) REFERENCES users (user_id));
            CREATE UNIQUE INDEX patient_que_patient_que_id_uindex ON patient_que (patient_que_id);
        </sql>
    </changeSet>

</databaseChangeLog>