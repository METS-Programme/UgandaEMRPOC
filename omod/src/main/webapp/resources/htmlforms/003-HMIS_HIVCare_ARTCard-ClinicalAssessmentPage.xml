<htmlform formName="HMIS 003 HIV Care ART Card - Clinical Assessment"
          formDescription="A visit for a client for clinical assessment "
          formEncounterType="8d5b2be0-c2cc-11de-8d13-0010c6dffd0f"
          formUuid="12de5bc5-352e-4faf-9961-a2125085a75c"
          formVersion="3.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.visitActions"
          formOrder="2"
          formIcon="icon-medkit"
          formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false &amp;&amp; sessionLocation.uuid=='86863db4-6101-4ecf-9a86-5e716d6504e4'"
          formDisplayStyle="Standard">

    <!-- jquery loaded for nonessential purposes. -->
    <script type="text/javascript">

        <ifMode mode="ENTER,EDIT" include="false">
            <includeIf velocityTest="$fn.allEncounters('8d5b27bc-c2cc-11de-8d13-0010c6dffd0f').size() == 0">
                <!-- jq(function () {
                    jq().toastmessage('showErrorToast', "This patient has no Summary page");
                    alert('This patient has no Summary page, you will now be forwarded to the patient dashboard');

                    /*
                    * queryParameters -> handles the query string parameters
                    * queryString -> the query string without the fist '?' character
                    * re -> the regular expression
                    * m -> holds the string matching the regular expression
                    */
                    var queryParameters = {}, queryString = location.search.substring(1),
                    re = /([^&amp;=]+)=([^&amp;]*)/g, m;

                    // Creates a map with the query string parameters
                    while (m = re.exec(queryString)) {
                        queryParameters[decodeURIComponent(m[1])] = decodeURIComponent(m[2]);
                    }

                    /*
                    * Replace the query portion of the URL.
                    * jQuery.param() -> create a serialized representation of an array or
                    * object, suitable for use in a URL query string or Ajax request.
                    */
                    location.href = window.location.protocol + "//" + window.location.host +
                    '/' + OPENMRS_CONTEXT_PATH + '/coreapps/clinicianfacing/patient.page?patientId='
                    + queryParameters['patientId']; // Causes page to reload
                }); -->
            </includeIf>
        </ifMode>

        if (jQuery) {

            var instabilityCause = "";

            function diff_months(dt2, dt1) {
                var diff = (dt2.getTime() - dt1.getTime()) / 1000;
                diff /= (60 * 60 * 24 * 7 * 4);
                return Math.abs(Math.round(diff));
            }


            jq(document).ready(function () {

                <!-- Determine muac code based on muac score and age -->
                var age  =  <lookup complexExpression="$patient.age"/>;
                getMUACCodeFromMUACScoreByAge(age);

                //Block Multiple encounter entry on same date
                blockEncounterOnSameDateEncounter(jq("#encounterDate").find("input[type=hidden]"),"block");

                var stableArray = [];

                var previousVl = jq("#vl").text().trim();
                var currentRegimen = jq("#regimen").text().trim();
                var regimenBeforeDTG = jq("#regimen_before_dtg").text().trim();
                var onThirdLine = jq("#on_third_line").text().trim();
                var adherence = jq("#adherence").text().trim();
                var clinicStaging = jq("#clinic_staging").text().trim();
                var regimenStartedDate = jq("#regimen_started_date").text().trim();
                var regimenBeforeDTGStartedDate = jq("#regimen_started_date_before_dtg").text().trim();
                var sputumDate = jq("#sputum_date").text().trim();
                var artStartDate = jq("#art_start_date").text().trim();
                var teatmentStartDate = jq("#teatment_start_date").text().trim();
                var sputumValue = jq("#sputum_value").text().trim();
                var currentRegimenStartDate = jq("#current_regimen_start_date").text().trim();

                if (regimenBeforeDTG &amp;&amp; regimenBeforeDTG !== "") {
                    regimenStartedDate = regimenBeforeDTGStartedDate;
                }

                var durationOnART;
                var durationOnCurrentRegimen;

                if (artStartDate !== "") {
                    durationOnART = diff_months(new Date(artStartDate), new Date(jq("#encounterDate").find("input[type=hidden]").val()));
                    jq("#99024 input").val(durationOnART);
                }

                if (currentRegimenStartDate !== "") {
                    durationOnCurrentRegimen = diff_months(new Date(currentRegimenStartDate), new Date(jq("#encounterDate").find("input[type=hidden]").val()));
                    jq("#99025 input").val(durationOnCurrentRegimen);
                }

                fieldHelper.makeReadonly(jq("#99025 input"));
                fieldHelper.makeReadonly(jq("#99024 input"));


                disableContainer("#165144");

                stabilityCheck();

                <!-- Enable TB fields only if TB RX is selected-->

                function enable_disable_district_tb_reg(selected_option) {

                    var class_name = jq(selected_option).attr("class");

                    var length = class_name.length;

                    var class_id = parseInt(class_name.substring(length - 1, length))

                    var row_id = class_id;

                    var disable = true;
                    var requires = false;

                    var row_1 = '[class^="DistrictTbReg"][class*="Child1"]';

                    var xx = row_1;
                    var selected_value = jq(selected_option).find(":selected").attr("value");

                    if (selected_value == "90071") {
                        disable = false;
                        requires = true;
                    }

                    switch (row_id) {
                        case 1:
                        xx = row_1;
                        break;
                    }

                    jq(xx).each(function () {
                        var group = jq(this);

                        if (class_name.indexOf('Child') == -1) {
                            /* group.find("input").attr("value", ""); */
                            group.find("input").attr("required", requires);
                            /* group.find('select').prop("selectedIndex", 0); */
                            group.find("input").attr("disabled", disable);
                            group.find('select').attr("disabled", disable);
                            if (requires == false) {
                                group.find('.required').show();
                            }
                            else if (requires == true) {
                                group.find('.required').hide();
                            }

                            if (disable) {
                                /* fade out the fields that are disabled */
                                group.find("input").fadeTo(250, 0.25);
                                group.find("select").fadeTo(250, 0.25);
                            } else {
                                /* remove the fade on the fields */
                                group.find("input").fadeTo(250, 1);
                                group.find("select").fadeTo(250, 1);
                            }
                        }
                    });
                }

                /* Validation of the ART regimen Selected */
                jq("#90315").change(function () {
                    var regimen_encounter_page_value = jq("#90315").find("select").find(":selected").val();
                    var regimen_encounter_page_text = jq("#90315").find("select").find(":selected").text();
                    var art_transfer_regimen = jq("#artTransferRegimen").html();
                    var other_art_transfer_regimen = jq("#otherArtTransferRegimen").html();
                    var art_start_regimen = jq("#artStartRegimen").html();
                    var other_art_start_regimen = jq("#otherArtStartRegimen").html();
                    var first_second_regimen = jq("#firstSecondLineRegimen").html();
                    var other_first_second_regimen = jq("#otherFirstSecondLineRegimen").html();
                    var third_second_regimen = jq("#thirdLineRegimen").html();
                    var other_third_regimen = jq("#otherThirdLineRegimen").html();
                    var patient_regimen = other_third_regimen + third_second_regimen + other_first_second_regimen + other_first_second_regimen + first_second_regimen + other_art_start_regimen + art_start_regimen + other_art_transfer_regimen + art_transfer_regimen;

                    /* Check if  Patient has art start or tranfer regimen selected on ART Summary Page*/
                    if (art_start_regimen == "null" &amp;&amp; art_transfer_regimen == "null") {
                        jq().toastmessage('showNoticeToast', "Patient Doesn't have any either ART Start or Transfer regimen on ART Summary selected");
                    }

                    if (!patient_regimen.includes(regimen_encounter_page_value)) {
                        jq().toastmessage('showNoticeToast', "The regimen" + regimen_encounter_page_text + "you have selected is different from the current regimen in the Summary page. Please update the summary page with a switch/substitution to the selected regimen");
                    }

                    if (currentRegimen !== jq("#90315").find("select").find(":selected").val()) {
                        jq("#99025 input").val(0);
                    }else {
                        jq("#99025 input").val(durationOnCurrentRegimen);
                    }
                    stabilityCheck();
                });
                /* End of Validation */

                /* Handle viral load results */
                jq("#viral-load-results-copies").attr("disabled", true);
                jq("#viral-load-results-qualitative").change(function () {
                    var viral_load_status = getValue('viral-load-results-qualitative.value');
                    if (viral_load_status == 1301) {
                        /* Detected */
                        jq("#viral-load-results-copies").attr("disabled", false).attr("readonly", false).fadeTo(250, 1);
                        <ifMode mode="ENTER">
                            setValue('viral-load-results-copies.value', '');
                        </ifMode>

                        var viral_load_copies = getValue('viral-load-results-copies.value');
                        if(viral_load_copies == 1){
                            setValue('viral-load-results-copies.value', '');
                        }
                    }
                    if (viral_load_status == 1306) {
                    /* Not Detected */
                        jq("#viral-load-results-copies").attr("disabled", false).attr("readonly", true).fadeTo(250, 0.25);
                        setValue('viral-load-results-copies.value', 1);
                    }
                    if (viral_load_status == "" || viral_load_status == 1304) {
                    /* Sample Rejected and no data */
                        jq("#viral-load-results-copies").attr("disabled", true).attr("readonly", true).fadeTo(250, 0.25);
                        setValue('viral-load-results-copies.value', '');
                    }
                });

                jq("#viral-load-results-copies").change(function () {
                    previousVl = jq("#viral-load-results-copies").find("input").val();
                    stabilityCheck();
                });

                // trigger a change when the form loads
                jq("#viral-load-results-qualitative").change();

                jq('[class^="ARTYesNoEnableDisable"]').change(function () {
                    enable_disable(jq(this), "ARTYesNo", 'selected_value == "yes" &amp;&amp; selected_value!=""', "select");
                });

                jq('[class^="ARTYesNoEnableDisable"]').each(function () {
                    enable_disable(jq(this), "ARTYesNo", 'selected_value == "yes" &amp;&amp; selected_value!=""', "select");
                });

                jq('[class^="RegimenEnableDisable"]').change(function () {
                    enable_disable(jq(this), "Regimen", 'selected_value == "other"', "select");
                });

                jq('[class^="RegimenEnableDisable"]').each(function () {
                    enable_disable(jq(this), "Regimen", 'selected_value == "other"', "select");
                });

                jq('[class^="OtherAppointmentReasonEnableDisable"]').change(function () {
                    enable_disable(jq(this), "OtherAppointmentReason", 'selected_value == "14. other specify"', "select");
                });

                jq('[class^="OtherAppointmentReasonEnableDisable"]').each(function () {
                    enable_disable(jq(this), "OtherAppointmentReason", 'selected_value == "14. other specify"', "select");
                });

                jq('[class^="DistrictTbRegEnableDisable"]').change(function () {
                    enable_disable_district_tb_reg(jq(this));
                });

                jq('[class^="DistrictTbRegEnableDisable"]').each(function () {
                    enable_disable_district_tb_reg(jq(this));
                });

                jq("#90203").change(function () {
                    clinicStaging = jq(this).find(":selected").val();
                    stabilityCheck();
                });

                jq("#returndate").each(function () {
                    if (jq("#returndate").find("input[type=hidden]").val() != "") {
                        enableContainer("#reason_for_appointment");
                    } else {
                        disableContainer("#reason_for_appointment");
                    }
                });

                jq("#returndate").change(function () {
                    if (jq("#returndate").find("input[type=hidden]").val() != "") {
                        enableContainer("#reason_for_appointment");
                    } else {
                        disableContainer("#reason_for_appointment");
                    }
                });

                jq(".ARTYesNoEnableDisable2").change(function () {
                    if(jq('.ARTYesNoEnableDisable2').find('#1065').find(':checkbox').prop('checked')) {
                        jq("#5596").find("input[type$='text']").attr("disabled",false);
                    }
                });

                /*determine viral load status*/

                jq("#viral-load-results-copies").keyup(function () {

                    if(jq("#viral-load-results-copies").find("input").val() &lt; 1000)
                        jq("#viral-load-status").val("Suppressed");
                    else
                        jq("#viral-load-status").val("Non-suppressed");
                });

                /*enable disable family planning options*/

                jq(".FamilyPlanningEnableDisable").find("input[type$='checkbox']").attr('disabled', true);
                jq(".FamilyPlanningEnableDisable").find("input[type$='checkbox']").fadeTo(250, 0.25);

                jq(".ARTYesNoEnableDisable1").change(function () {
                    if(jq(this).find("input[type='radio']:checked").val() == 90082) {
                        jq(".FamilyPlanningEnableDisable").find("input[type$='checkbox']").attr('disabled', false);
                        jq(".FamilyPlanningEnableDisable").find("input[type$='checkbox']").fadeTo(250, 1);
                    } else {
                        jq(".FamilyPlanningEnableDisable").find("input[type$='checkbox']").attr('disabled', true);
                        jq(".FamilyPlanningEnableDisable").find("input[type$='checkbox']").fadeTo(250, 0.25);
                    }
                });

                /*enable disable TPT prescription*/

                jq(".TPTEnabelDisable").find("input[type$='text']").attr('disabled', true);
                jq(".TPTEnabelDisable").find("input[type$='text']").fadeTo(250, 0.25);

                jq("#90216").change(function () {
                    if(jq(this).find(":selected").val() == 90072) {
                        jq(".TPTEnabelDisable").find("input[type$='text']").attr('disabled', false);
                        jq(".TPTEnabelDisable").find("input[type$='text']").fadeTo(250, 1);
                    } else {
                        jq(".TPTEnabelDisable").find("input[type$='text']").attr('disabled', true);
                        jq(".TPTEnabelDisable").find("input[type$='text']").fadeTo(250, 0.25);
                    }
                });

                /*enable disable Art adherence*/

                jq(".EnableDisableAdherenceReason").find("input[type$='checkbox']").attr('disabled', true);
                jq(".EnableDisableAdherenceReason").find("input[type$='checkbox']").fadeTo(250, 0.25);

                jq(".disableARTAdherence").change(function () {
                    var adherence = jq(this).find("input[type='radio']:checked").val();
                    if(adherence == 90157 || adherence == 90158) {
                        jq(".EnableDisableAdherenceReason").find("input[type$='checkbox']").attr('disabled', false);
                        jq(".EnableDisableAdherenceReason").find("input[type$='checkbox']").fadeTo(250, 1);
                    } else {
                        jq(".EnableDisableAdherenceReason").find("input[type$='checkbox']").attr('disabled', true);
                        jq(".EnableDisableAdherenceReason").find("input[type$='checkbox']").fadeTo(250, 0.25);
                    }
                });

                /*enable disable dapsone prescription*/

                jq(".EnableDisableDapsone").find("input[type$='text']").attr('disabled', true);
                jq(".EnableDisableDapsone").find("input[type$='text']").fadeTo(250, 0.25);

                jq(".IsTakingDapsone").change(function () {
                    var onDapsone = jq(this).find("input[type='radio']:checked").val();
                    if(onDapsone == 1065) {
                        jq(".EnableDisableDapsone").find("input[type$='text']").attr('disabled', false);
                        jq(".EnableDisableDapsone").find("input[type$='text']").fadeTo(250, 1);
                    } else {
                        jq(".EnableDisableDapsone").find("input[type$='text']").attr('disabled', true);
                        jq(".EnableDisableDapsone").find("input[type$='text']").fadeTo(250, 1);
                    }
                });

                /*enable disable Hepatitis B status*/

                jq(".EnableDisableHepBStatus").find("input[type$='radio']").attr('disabled', true);

                jq(".HepBStatus").change(function () {
                    var hepStatus = jq(this).find("input[type='radio']:checked").val();
                    if(hepStatus == 159971) {
                        jq(".EnableDisableHepBStatus").find("input[type$='radio']").attr('disabled', false);
                    } else {
                        jq(".EnableDisableHepBStatus").find("input[type$='radio']").attr('disabled', true);
                    }

                });

                /*enable disable fluconazole prescription*/

                jq(".EnableDisableFluconazole").find("input[type$='text']").attr('disabled', true)
                jq(".EnableDisableFluconazole").find("input[type$='text']").fadeTo(250, 0.25);

                jq(".EnableDisableFluconazolePills").find("input[type$='text']").attr('disabled', true);
                jq(".EnableDisableFluconazoleDays").find("input[type$='text']").attr('disabled', true);
                jq("#FluconazoleStartDate").change(function () {
                    if(jq(this).find("inpuprescriptiont[type='text']").val() !== "") {
                        jq(".EnableDisableFluconazole").find("input[type$='text']").attr('disabled', false);
                        jq(".EnableDisableFluconazole").find("input[type$='text']").fadeTo(250, 1);
                    } else {
                        jq(".EnableDisableFluconazole").find("input[type$='text']").attr('disabled', true);
                        jq(".EnableDisableFluconazole").find("input[type$='text']").fadeTo(250, 0.25);
                    }
                });

                jq("#bmi").find("input[type$='text']").attr('disabled', true);

                jq(".enableDisable").each(function () {
                    var group = jq(this);

                    function disableFn() {
                        group.children("#disabled").fadeTo(250, 0.25);
                        /*  group.children("#disabled").find(":checkbox").attr("checked", false); uncheck */
                        group.children("#disabled").find("input").attr("disabled", true);
                        /* disable */
                        group.children("#disabled").find("select").attr("disabled", true);
                    }

                    function enableFn() {
                        group.children("#disabled").fadeTo(250, 1);
                        group.children("#disabled").find("input").attr("disabled", false);
                        group.children("#disabled").find("select").attr("disabled", false);

                    }

                    if (jq(this).children("#trigger").find(":checkbox:first").attr("checked") != "checked") {
                        disableFn();
                    }

                    jq(this).children("#trigger").find(":checkbox:first").change(function () {
                        //var checked = jq(this).attr("checked");
                        if (jq(this).prop('checked')) {
                        enableFn();
                        } else {
                        disableFn();
                        }
                    });
                });

                function stabilityCheck() {
                    /*Viral Load Check*/

                    stableArray = [];
                    instabilityCause = "";

                    if (previousVl !== "" &amp;&amp; previousVl &lt;= 1000) {
                        stableArray.push(true);
                    } else {
                        stableArray.push(false);
                        instabilityCause = instabilityCause + "Viral Load is Not Suppressed \n ";
                    }

                    /* Third Line*/

                    if (onThirdLine !== "true") {
                        stableArray.push(true);
                    } else {
                        stableArray.push(false);
                        instabilityCause += "Current regimen is a third line regimen \n "
                    }

                    /* Adherence Check*/

                    if (adherence.length &lt;= 0 || adherence.trim().includes("POOR")) {
                        stableArray.push(false);
                        instabilityCause += "Adherence is not Good \n "
                    } else {
                        stableArray.push(true);
                    }

                    /* Clinic staging */
                    if (clinicStaging === "90033" || clinicStaging === "90034" || clinicStaging === "90293" || clinicStaging === "90294") {
                        stableArray.push(true);
                    } else {
                        stableArray.push(false);
                        instabilityCause += "Clinic stage is neither 1 or 2 \n";
                    }
                    var pageCurrentRegimen = jq("#90315").find("select").find(":selected").val();
                    var pageEncounterDate = jq("#encounterDate").find("input[type=hidden]").val();
                    var dsdmRegimenCoceptsIds="164976,164977,164978,164979";

                    if (currentRegimen !== "" &amp;&amp; (currentRegimen === pageCurrentRegimen || dsdmRegimenCoceptsIds.trim().includes(pageCurrentRegimen)) &amp;&amp; diff_months(new Date(pageEncounterDate), new Date(regimenStartedDate)) &gt; 12) {

                        stableArray.push(true);
                    } else {
                        stableArray.push(false);
                        instabilityCause += "Patient has not spent more than 12 moths on current Regiment \n "
                    }

                    if (sputumValue !== "" &amp;&amp; sputumValue !== "664" &amp;&amp; diff_months(new Date(jq("#encounterDate").find("input[type=hidden]").val()), new Date(teatmentStartDate)) &lt; 2) {
                        stableArray.push(false);
                        instabilityCause += "Patient has not been on treatment for TB for at least 2 months"
                    } else {
                        stableArray.push(true);
                    }
                    instabilityCause.trim().replace()

                    if (stableArray.indexOf(false) != -1) {
                        jq("#165144 select").val("90004");
                    } else {
                        jq("#165144 select").val("90003");
                    }

                }
                <!-- Enabling and Disabling Prescription of multiple drugs -->
                //addRemovePrescription();

                $allRows = jq(this).find('.multi-drug');
                $allRows.hide();
                jq('#1-removeEntry').remove();
                jq('#10-addEntry').remove();
                jq('#1-toggleContainer').show();

                jq('#11-removeEntry').remove();
                jq('#20-addEntry').remove();
                jq('#11-toggleContainer').show();

                jq('.addEntry').on("click", function() {
                    var correctedAddButtonId = parseFloat(this.id) + 1;
                    var contentAddId = "#" + correctedAddButtonId + "-toggleContainer";
                    jq(contentAddId).toggle(true);
                    jq('#' + this.id).toggle(false); jq('#' + parseFloat(this.id) + '-removeEntry').toggle(true);
                    return false;
                });

                jq('.removeEntry').on("click", function() {
                    var correctedRemoveButtonId = parseFloat(this.id) - 1;
                    var contentAddId = "#" + parseFloat(this.id) + "-toggleContainer";
                    jq(contentAddId).toggle(false);
                    jq( ':input:not(:button)', contentAddId).val([]);
                    jq('#' + correctedRemoveButtonId + '-addEntry').toggle(true); jq('#' + correctedRemoveButtonId + '-removeEntry').toggle(true);

                    return false;
                });

        });

        <!-- Validation rules -->
        beforeSubmit.push(function () {
        <!-- clear the previous errors -->
            setValue('returndate.error', '');
            setValue('viral-load-results-copies.error', '');
            setValue('date-viral-load-taken.error', '');

            var encounterDate = new Date((getValue('encounterDate.value')));
            var returnDate = new Date((getValue('returndate.value')));

            if (encounterDate &gt;= returnDate) {
                getField('errors-field.error').html('The return date must be after the date of this visit ' +
                formatDateForDisplay(encounterDate)).show();
                return false;
            }

            <!-- Check that the return date is before the transfer out date only if there is a transfer out date -->
            if (jq('#transfer_out_date_id').html().replace(/\s+/, "").length > 0) {
                var transfer_out_date_id = new Date(jq('#transfer_out_date_id').html());
                if (returnDate &gt;= transfer_out_date_id) {
                    getField('returndate.error').html('The return date must be before the transfer out date of ' +
                    formatDateForDisplay(transfer_out_date_id)).show();
                    return false;
                }
                return false;
            }

            var viral_load_qualitative = getValue('viral-load-results-qualitative.value');
            var date_viral_load_taken = getValue('date-viral-load-taken.value');
            /* The date that the viral load was taken is required if a qualitative result is selected */
            if (viral_load_qualitative != "") {
                if (date_viral_load_taken == "") {
                    getField('date-viral-load-taken.error').html('Please enter the date when the viral load sample was taken').show();
                    return false;
                }
            }

            /** The date the viral load was taken cannot be after the encounter date */
            if (date_viral_load_taken != "") {
                if (encounterDate &lt; date_viral_load_taken) {
                    getField('date-viral-load-taken.error').html('The date the viral load sample was taken cannot be after the date of this visit ' + encounterDate).show();
                    return false;
                }
            }

            /* If the viral load is detected, the number of copies must be greater than 20 which is the lowest detectable level for a machine */
            if ((viral_load_qualitative == 1301) &amp;&amp; (getValue('viral-load-results-copies.value') &lt; 20)) {
                getField('viral-load-results-copies.error').html('Please enter the number of virus copies per ml. the minimum number of copies is 20').show();
                return false;
            }

            /* if DSDM is not FBIM or FTR or Empty and patient is not stable should not save.*/
            if (jq("#165144").find("select").find(":selected").val() !== "90003" &amp;&amp; (jq("#165143").find("select").find(":selected").val() !== "165138" &amp;&amp; jq("#165143").find("select").find(":selected").val() !== "165140" &amp;&amp; jq("#165143").find("select").find(":selected").val() !== "")) {
                getField('165143.error').html('Patient Not Stable due to ' + instabilityCause + '. \n Only Stable Patients can be enrolled in ' + jq("#165143").find("select").find(":selected").text()).show();

                jq().toastmessage('showErrorToast', " Patient Not Stable " + instabilityCause + ". \n Only Stable Patients can be enrolled in " + jq("#165143").find("select").find(":selected").text());
                return false;
            }
            return true;
        });
        }

        <!-- only show BMI if patient is more than 5 years old (on the encounterDate) -->
        <includeIf velocityTest="$patient.getAge($encounter.getEncounterDatetime()) > 5">

            var calculateBmi = function(wt, ht) {
            var bmi = null
            if (wt &amp;&amp; ht) {
            bmi = wt / ((ht/100) * (ht/100));
            }
            return bmi ;
            }

            <ifMode mode="ENTER">

                // functions to handle updating the bmi when in ENTER mode
                    var updateBmi = function() {
                    var wt = htmlForm.getValueIfLegal('weight.value');
                    var ht = htmlForm.getValueIfLegal('height.value');

                    var bmi = calculateBmi(wt, ht);

                    if (bmi == null || isNaN(bmi)) {
                        jq('#calculated-bmi-wrapper').hide();
                    } else {
                        jq('#no-calculated-bmi').hide();
                        jq('#calculated-bmi-wrapper').show();
                        jq('#calculated-bmi').html(bmi.toFixed(1));
                        jq('#hidden-calculated-bmi').val(bmi.toFixed(1));
                    }
                };

                jq(function() {
                    jq('#calculated-bmi-wrapper').hide();

                    getField('weight.value').change(updateBmi)
                    getField('height.value').change(updateBmi);

                    updateBmi();
                });

                jq(function() {
                    jq('#bp_systolic input[type=text]').attr('min', '50');
                });

                jq(function() {
                    jq('#bp_diastolic input[type=text]').attr('min', '30');
                });

            </ifMode>

                // set the blood pressure fields as "expected"
                jq(function() {
                    jq('#bp_systolic > input').addClass('expected');
                    jq('#bp_diastolic > input').addClass('expected');
                });

            <ifMode mode="VIEW">
                // handle displaying the bmi when in VIEW mode
                jq(function() {

                    // we have to iterate through in case there are multiple vitals forms
                    // displayed on a single page

                    jq('htmlform').each(function(index, form) {
                        jq(form).find('#calculated-bmi-continue').hide();
                        jq(form).find('#no-calculated-bmi').hide();

                        var wt = jq(form).find('#weight').find('.value').text();
                        var ht = jq(form).find('#height').find('.value').text();

                        var bmi = calculateBmi(wt, ht);

                        if (bmi != null &amp;&amp; !isNaN(bmi)) {
                            jq(form).find('#calculated-bmi-wrapper').show();
                            jq(form).find('#calculated-bmi').html(bmi.toFixed(1));
                            jq(form).find('#hidden-calculated-bmi').val(bmi.toFixed(1));
                        }
                    });

                });

            </ifMode>
        </includeIf>

    </script>

    <!-- This section contains lookup tags that pick data from other forms-->

    <lookup complexExpression="#set($art_start_regimen='null') #set($other_art_start_regimen='null') #set($art_transfer_regimen='null') #set($other_art_transfer_regimen='null')"/>

    <lookup complexExpression="#set($first_second_line_regimen='null') #set($other_first_second_line_regimen='null')"/>

    <lookup complexExpression="#set($third_line_regimen='null') #set($other_third_line_regimen='null')"/>

    <span class="hidden" id="artStartRegimen"><lookup
            complexExpression="#set($art_start_regimen=($fn.latestObs('99061').valueCoded))$art_start_regimen"/></span>

    <span class="hidden" id="otherArtStartRegimen"><lookup
            complexExpression="#set($other_art_start_regimen=($fn.latestObs('99268').valueText))$other_art_start_regimen"/></span>

    <span class="hidden" id="artTransferRegimen"><lookup
            complexExpression="#set($art_transfer_regimen=$fn.latestObs('99064').valueCoded)$art_transfer_regimen"/></span>

    <span class="hidden" id="otherArtTransferRegimen"><lookup
            complexExpression="#set($other_art_transfer_regimen=$fn.latestObs('99269').valueText)$other_art_transfer_regimen"/></span>

    <span class="hidden" id="firstSecondLineRegimen"><lookup
            complexExpression="#foreach($first_second_line_regimen in $fn.allObs(90315)) $first_second_line_regimen.valueCoded #end"/></span>

    <span class="hidden" id="otherFirstSecondLineRegimen"><lookup
            complexExpression="#foreach($other_first_second_line_regimen in $fn.allObs(99146)) $other_first_second_line_regimen.valueText #end"/></span>


    <span class="hidden" id="thirdLineRegimen"><lookup
            complexExpression="#foreach($third_line_regimen in $fn.allObs(162990)) $first_second_line_regimen.valueCoded #end"/></span>

    <span class="hidden" id="otherThirdLineRegimen"><lookup
            complexExpression="#foreach($other_third_line_regimen in $fn.allObs(162989)) $other_first_second_line_regimen.valueText #end"/></span>

    <!--End of Lookup section-->

    <div>
        <div class="row">
            <div class="col-md-6">
                <h1>HMIS HIV 003:HIV CARE/ART CARD - CLINICAL ASSESSMENT PAGE</h1>
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-2">
                <span class="submitButton">
                    <postSubmissionAction class="org.openmrs.module.aijar.htmlformentry.DSDSProgramSubmissionAction" />
                    <submit submitStyle="customSubmit" class="confirm" submitLabel="Save"/>
                </span>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header header-success">
                        <ul class="nav nav-tabs card-header-tabs nav-fill nav-success">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#appointment-vitals-nutrition">Appointment/ Vitals/ Nutrition Assessment </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#pregnancy-fp"> Pregnancy/ Family Planning </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#tb-treatment-clinical-assessment">TB Treatment/ Clinical Assessment </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#medication"> Medication</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#investigations"> Tests and Investigations/DSDM </a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="tab-pane active" id="appointment-vitals-nutrition">
                                <section>
                                    <div class="card">
                                        <div class="card-header">Appointment</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Visit Date</label>
                                                    <encounterDate default="today" disallowMultipleEncountersOnDate="block"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <excludeIf velocityTest="$patient.person.dead ==true">
                                                        <lookup complexExpression="#set($transfer_out_date = '')"/>
                                                        <ifMode mode="ENTER">
                                                            <span id="transfer_out_date_id" class="hidden"><lookup
                                                                    complexExpression="#set($transfer_out_date=($fn.latestObs('99165').valueDatetime)) #set($lost_to_follow_date=$fn.latestObs('99165').valueDatetime) #set($transfer_out=$fn.latestObs('90306').valueCoded.name) $transfer_out_date"/>
                                                            </span>
                                                            <includeIf velocityTest="$transfer_out=='YES'">
                                                                <label>Return date</label>
                                                                <obs id="returndate" conceptId="5096" allowFutureDates="true" />
                                                            </includeIf>

                                                            <includeIf velocityTest="$transfer_out!='YES'">
                                                                <label>Return date</label>
                                                                <obs id="returndate" conceptId="5096" required="required" allowFutureDates="true" />
                                                            </includeIf>
                                                        </ifMode>

                                                        <ifMode mode="EDIT">
                                                            <span id="transfer_out_date_id" class="hidden"><lookup
                                                                    complexExpression="#set($transfer_out_date=($fn.latestObs('99165').valueDatetime)) #set($lost_to_follow_date=$fn.latestObs('99165').valueDatetime) #set($transfer_out=$fn.latestObs('90306').valueCoded.name) $transfer_out_date"/>
                                                            </span>
                                                            <includeIf velocityTest="$transfer_out=='YES'">
                                                                <label>Return date</label>
                                                                <obs id="returndate" conceptId="5096" allowFutureDates="true" />
                                                            </includeIf>

                                                            <includeIf velocityTest="$transfer_out!='YES'">
                                                                <label>Return date</label>
                                                                <obs id="returndate" conceptId="5096" required="required" allowFutureDates="true" />
                                                            </includeIf>
                                                        </ifMode>
                                                    </excludeIf>
                                                </div>
                                                <div class="col-md-3">
                                                    <span class="OtherAppointmentReasonEnableDisable1">
                                                        <label>Reasons for next appointment</label>
                                                        <obs id="reason_for_appointment" conceptId="160288"
                                                             answerConceptIds="164968,164972,164970,856,5497,163153,164971,164973,99324,164974,90012,903,5484,90002"
                                                             answerLabels="1. ART Initiation, 2. ART Refill, 3. ART Regimen Switch/ Substitution, 4. Viral Load, 5. CD4, 6. IAC, 7. T.B Drug Refill,8. T.B Follow up, 9. ANC,10. EID,11. PMTCT, 12. Hypertension/ Diabetes, 13. Nutrition,14. Other Specify"/>
                                                    </span>
                                                </div>
                                                <div class="col-md-3">
                                                    <span class="OtherAppointmentReasonEnableDisableChild1">
                                                        <label>Other Reason for next appointment</label>
                                                        <obs conceptId="164975" />
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <obs conceptId="90069" labelText="Visit on Schedule" style="checkbox"/>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label><span class="required">*</span>Attending Clinician</label>
                                                    <encounterProvider role="Provider" style="autocomplete"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">Vitals</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Weight (kg)</label>
                                                    <obs conceptId="CIEL:5089" id="weight"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Height (cm)</label>
                                                    <obs conceptId="CIEL:5090" id="height"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <!-- only show BMI if patient is more than 5 years old (on the encounterDate) -->
                                                    <includeIf velocityTest="$patient.getAge($encounter.getEncounterDatetime()) > 5">

                                                        <label>
                                                            <uimessage code="referenceapplication.vitals.bmi.title"/>
                                                        </label>
                                                        <span id="calculated-bmi-wrapper">
                                                            <ifMode mode="VIEW" include="false">
                                                                <uimessage code="referenceapplication.vitals.bmi.display"/>
                                                            </ifMode>
                                                            <span id='calculated-bmi'></span>
                                                        </span>
                                                        <p id="calculated-bmi-continue">
                                                            <input type="hidden" name="focus-in-bmi-question" id="hidden-calculated-bmi"/>
                                                        </p>

                                                    </includeIf>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Temperature (c)</label>
                                                    <obs conceptId="CIEL:5088" id="temperature" />
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Heart Rate (/min)</label>
                                                    <obs conceptId="CIEL:5087" id="heart_rate" />
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Respiratory Rate (/min)</label>
                                                    <obs conceptId="CIEL:5242" id="respiratory_rate" />
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Systolic Blood Pressure</label>
                                                    <obs conceptId="CIEL:5085" id="bp_systolic"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Systolic Blood Pressure</label>
                                                    <obs conceptId="CIEL:5086" id="bp_diastolic" />
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>MUAC Score</label>
                                                    <obs conceptId="CIEL:1343" id="muac-score" />
                                                </div>
                                                <div class="col-md-3">
                                                    <span class="muac">
                                                        <includeIf velocityTest="$patient.age &lt; 5">
                                                            <label>MUAC Code</label>
                                                            <obs id="muac-code" conceptId="99030" answerConceptIds="99028,99029,99027"
                                                                 answerLabels="Red &lt; 11.5cm, Yellow 11.5cm - &lt;12.5cm,Green &gt;= 12.5cm"/>
                                                        </includeIf>
                                                        <includeIf velocityTest="$patient.age &lt; 10 &amp;&amp; $patient.age &gt;=5">
                                                            <label>MUAC</label>
                                                            <obs id= "muac-code" conceptId="99030" answerConceptIds="99028,99029,99027"
                                                                 answerLabels="Red &lt; 13.5cm,Yellow 13.5cm - &lt;14.5cm,Green &gt;=14.5cm" />
                                                        </includeIf>
                                                        <includeIf velocityTest="$patient.age &lt; 18 &amp;&amp; $patient.age &gt;=10">
                                                            <label>MUAC</label>
                                                            <obs id= "muac-code" conceptId="99030" answerConceptIds="99028,99029,99027"
                                                                 answerLabels="Red &lt; 16.5cm, Yellow 16.5cm - &lt;19.0cm,Green &gt;=19.0cm" />
                                                        </includeIf>

                                                        <includeIf velocityTest="$patient.age &gt;=18">
                                                            <label>MUAC</label>
                                                            <obs id= "muac-code" conceptId="99030" answerConceptIds="99028,99029,99027"
                                                                 answerLabels="Red &lt;19.0cm , Yellow 19.0cm - &lt;22.0cm,Green &gt;=22.0cm" />
                                                        </includeIf>
                                                    </span>
                                                </div>
                                                <excludeIf velocityTest="$patient.age &gt; 11">
                                                    <div class="col-md-3">
                                                        <label>Z-Scores</label>
                                                        <obs conceptId="99800" answerConceptIds="99803,99804,99805,99806,99807"
                                                             answerLabels="&#60;-3,-3_&#60;-1,-1_1,&#62;1_3,&#62;3"/>
                                                    </div>
                                                </excludeIf>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                    <div class="card-header">Nutrition Assessment</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Nutrition Status </label>
                                                    <obs conceptId="165050" answerConceptIds="1115,99271,99272,99273,5277,165301"
                                                         answerLabels="Normal, Moderate Acute Malnutrition, Severe Acute Malnutrition, Severe Acute Malnutrition with Oedema, Overweight/Obese"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Nutrition Support</label>
                                                    <obs conceptId="99054" answerConceptIds="99053,99050,99051,99052"
                                                         answerLabels="Therapeutic Feeding (F75 F100 RUTF), Supplementary Feeding, Infant and Young Child Feeding Counselling ( &gt; 2yrs), Nutrition Counselling only (if &gt; 2yrs)"/>
                                                </div>
                                                <excludeIf velocityTest="$patient.age &gt; 11">
                                                    <div class="col-md-3">
                                                        <obs labelText="Z-Scores" conceptId="99800" answerConceptIds="99803,99804,99805,99806,99807"
                                                             answerLabels="&#60;-3,-3_&#60;-1,-1_1,&#62;1_3,&#62;3"/>
                                                    </div>
                                                </excludeIf>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>

                            <div class="tab-pane" id="pregnancy-fp">
                                <section>
                                    <div class="card">
                                        <div class="card-header">Pregnancy</div>
                                        <div class="card-body">
                                            <excludeIf velocityTest="$patient.gender =='M' || $patient.age &lt; 9">
                                                <div class="row">
                                                    <div class="col-md-12 horizontal">
                                                        <span class="ARTYesNoEnableDisable2">
                                                            <obs id="1065" conceptId="90041" answerConceptId="1065" answerLabel="Pregnant"/>
                                                            <obs conceptId="90041" answerConceptId="99601" answerLabel="Breast Feeding"/>
                                                            <obs conceptId="90041" answerConceptId="1066" answerLabel="Not pregnant or not breast feeding"/>
                                                            <obs conceptId="90041" answerConceptId="1175" answerLabel="Unknown"/>
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <label>EDD</label>
                                                        <span class="ARTYesNoEnableDisableChild2">
                                                            <obs id="5596" conceptId="5596" allowFutureDates="true"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <span class="ARTYesNoEnableDisable3">
                                                            <label>EMTCT</label>
                                                            <obs conceptId="90012" answerConceptIds="90003,90004"
                                                                 answerLabels="Yes,No"/>
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <span class="ARTYesNoEnableDisableChild3">
                                                            <label>Age in months</label>
                                                            <obs conceptId="99270" />
                                                        </span>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <span class="ARTYesNoEnableDisableChild3">
                                                            <label>ANC No.</label>
                                                            <patient field="identifier" identifierTypeId="b0cc255e-ef57-4266-839e-0df7f5099eb9"
                                                                     required="false"/>
                                                        </span>
                                                    </div>
                                                </div>
                                            </excludeIf>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">Family Planning</div>
                                        <div class="card-body">
                                            <excludeIf velocityTest="$patient.age &lt; 9">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        Is on Family Planning ?
                                                        <span class="ARTYesNoEnableDisable1 horizontal">
                                                            <obs conceptId="90238" answerConceptIds="90082,90081" answerLabels="Yes,No" style="radio" />
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                        <label>Family Planning Method:</label>
                                                    <div class="col-md-4">
                                                        <span class="FamilyPlanningEnableDisable">
                                                            <obs conceptId="374" answerConceptId="190" answerLabel="1 - Condoms"/>
                                                            <excludeIf velocityTest="$patient.gender =='M' ">
                                                                <span class="lablex2">
                                                                    <obs conceptId="374" answerConceptId="780" answerLabel="2 - Oral Contraceptive pills"/>
                                                                </span>
                                                            </excludeIf>
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="col-md-4">
                                                    <span class="FamilyPlanningEnableDisable">
                                                        <excludeIf velocityTest="$patient.gender =='M' ">
                                                            <obs conceptId="374" answerConceptId="5279"
                                                                 answerLabel="3 - Injectable/Implantable hormonies"/>
                                                            <obs conceptId="374" answerConceptId="162961"
                                                                 answerLabel="4 - Implants"/>
                                                            <obs conceptId="374" answerConceptId="5278"
                                                                 answerLabel="5 - Diaphram/Cervical Cap"/>
                                                            <obs conceptId="374" answerConceptId="5275"
                                                                 answerLabel="6 - Intra uterine device (IUD)"/>
                                                            <obs conceptId="374" answerConceptId="5277"
                                                                 answerLabel="7 - Fertility Awareness Methods"/>
                                                        </excludeIf>
                                                    </span>
                                                </div>

                                                <div class="col-md-4">
                                                    <span class="FamilyPlanningEnableDisable">
                                                        <excludeIf velocityTest="$patient.gender =='F' ">
                                                            <obs conceptId="374" answerConceptId="99265"
                                                                 answerLabel="2 - Vasectomy/Tubal ligation"/>
                                                        </excludeIf>
                                                    </span>
                                                </div>
                                            </excludeIf>
                                        </div>
                                    
                                        <excludeIf velocityTest="$patient.gender =='M' ">
                                            
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <label>Intention to conceive in the next three months</label>
                                                        <obs conceptId="165316" answerConceptIds="1065,1066" answerLabels="Yes,No" style="radio" class="horizontal"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label>CaCx Status</label>
                                                        <obs conceptId="165315" id="cacxStatus" answerConceptIds="165313, 1175, 165314, 1364" answerLabels="No evidence of Malignancy, Not Applicable, Suspicious of Malignancy, Not eligible"/>
                                                    </div>
                                                </div>
                                        </excludeIf>
                                    </div>
                                    </div>
                                </section>
                            </div>

                            <div class="tab-pane fade" id="tb-treatment-clinical-assessment">
                                <section>
                                    <div class="card">
                                        <div class="card-header">TB Treatment</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Tb Status</label>
                                                    <span class="DistrictTbRegEnableDisable1">
                                                        <obs conceptId="90216" answerConceptIds="90079,90073,90078,90071"
                                                             answerLabels="1. No signs,2. Suspect,3. Diagnosed with Tb,4. Tb Rx"/>
                                                    </span>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>TB Start Date</label>
                                                    <span class="DistrictTbRegEnableDisableChild1">
                                                        <obs conceptId="90217"/>
                                                    </span>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>TB Stop Date</label>
                                                    <span class="DistrictTbRegEnableDisableChild1">
                                                        <obs conceptId="90310" allowFutureDates="true"/>
                                                    </span>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>District TB No.</label>
                                                    <span class="DistrictTbRegEnableDisableChild1">
                                                        <patient field="identifier" identifierTypeId="8110f2d2-1f98-4c38-aef3-11b19bb0a589"
                                                        required="false"/>
                                                    </span>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>TPT Status</label>
                                                    <obs id="165288" conceptId="165288"
                                                         answerConceptIds="1090,90072,165307,90040,160035"
                                                         answerLabels="H0-Never Initiated,H1-On INH,H2-Defaulted,H3-Taken off due to side effects,H4-Completed"/>
                                                </div>
                                                <div class="col-md-3 TPTB6EnabelDisable">
                                                    <label>No. TPT Pills</label>
                                                    <obs conceptId="165278"/>
                                                </div>
                                                <div class="col-md-3 TPTB6nabelDisable">
                                                    <label>No. B6 Pills</label>
                                                    <obs conceptId="165279"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">Signs and Symptoms</div>
                                        <div class="card-body">
                                            <div class ="row">
                                                <div class="col-md-3">
                                                    <obs conceptId="90251" answerConceptId="90139" answerLabel="Oral or anal ulcers"/>
                                                    <obs conceptId="90251" answerConceptId="90094" answerLabel="Headache"/>
                                                    <obs conceptId="90251" answerConceptId="90135" answerLabel="Weight loss in last month"/>
                                                    <obs conceptId="90251" answerConceptId="90130" answerLabel="Whites spots/thrush in mouth"/>
                                                    <obs conceptId="90251" answerConceptId="90132" answerLabel="Cough or shortness of breath > 1 week"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <obs conceptId="90251" answerConceptId="90116" answerLabel="Fever, chills or night sweats > 1 week"/>
                                                    <obs conceptId="90251" answerConceptId="206" answerLabel="New seizure"/>
                                                    <obs conceptId="90251" answerConceptId="165285" answerLabel="Weak arms/legs"/>
                                                    <obs conceptId="90251" answerConceptId="16" answerLabel="Diarrhea > 1 week"/>
                                                    <obs conceptId="90251" answerConceptId="165286" answerLabel="Acting unusual"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <obs conceptId="90251" answerConceptId="165287" answerLabel="Difficulty walking"/>
                                                    <obs conceptId="90251" answerConceptId="5953" answerLabel="Double or Blurry vision"/>                                                    
                                                    <obs conceptId="90251" answerConceptId="861" answerLabel="Decreased hearing"/>
                                                    <obs conceptId="90251" answerConceptId="118789" answerLabel="Difficulty or painful swallowing"/>
                                                    <obs conceptId="90251" answerConceptId="79" answerLabel="Red/purple or dark spots on skin"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <obs conceptId="90251" answerConceptId="122936" answerLabel="Unable to walk without assisstance"/>
                                                    <span class="enableDisable">
                                                        <span id="trigger">
                                                            <obs conceptId="90251" answerConceptId="90002"
                                                                 answerLabel="Other specify:"/>
                                                        </span>
                                                        <span id="disabled">
                                                            <obs conceptId="99113" size="17" labelText=""/>
                                                        </span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>  

                                    <div class="card">
                                        <div class="card-header">Side effects of ART</div>
                                        <div class="card-body">  
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <obs conceptId="90227" answerConceptId="90100" answerLabel="AB"/>
                                                    <obs conceptId="90227" answerConceptId="90099" answerLabel="Anaemia"/>
                                                    <obs conceptId="90227" answerConceptId="90095" answerLabel="BN"/>
                                                    <obs conceptId="90227" answerConceptId="90117" answerLabel="CNS"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <obs conceptId="90227" answerConceptId="90092" answerLabel="Diarrhoea"/>
                                                    <obs conceptId="90227" answerConceptId="90116" answerLabel="FAT"/>
                                                    <obs conceptId="90227" answerConceptId="90093" answerLabel="Fatigue"/>
                                                    <obs conceptId="90227" answerConceptId="90094" answerLabel="Headache"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <obs conceptId="90227" answerConceptId="90115" answerLabel="Jaundice"/>
                                                    <obs conceptId="90227" answerConceptId="90091" answerLabel="Nausea"/>
                                                    <obs conceptId="90227" answerConceptId="90098" answerLabel="Rash"/>
                                                    <obs conceptId="90227" answerConceptId="122983" answerLabel="Vomiting"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <span class="enableDisable">
                                                        <span id="trigger">
                                                            <obs conceptId="90227" answerConceptId="90002"
                                                                 answerLabel="Other specify:"/>
                                                        </span>
                                                        <span id="disabled">
                                                            <obs conceptId="99113" size="17" labelText=""/>
                                                        </span>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">Diagnosis</div>
                                        <div class="card-body"> 
                                            <div class ="row">
                                                <div class ="col-md-4">
                                                    <div class ="row">
                                                        <div class ="col-md-12">
                                                            <encounterDiagnoses required="false" selectedDiagnosesTarget="" preferredCodingSource="ICD-10-WHO"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class ="col-md-6">
                                                    <div class ="row">
                                                        <div class ="col-md-12">
                                                            <div class="row">
                                                                <div class="col-md-8">
                                                                    <lable>Advanced Disease Status</lable>
                                                                    <obs conceptId="165272" answerConceptIds="165309, 165266, 165267, 165268, 165269, 165270, 165271"
                                                                         answerLabels="No Advanced Disease, Suspected Advanced Disease, Confirmed Advanced Disease CD4 &lt; 200, Confirmed Advanced Disease-Pos CrAg, Confirmed Advanced Disease-Pos TB, Confirmed Advanced Disease - WHO Stage 3/4, Confirmed Advanced Disease - Child &lt; 5 Yrs"/>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <lable>WHO Clinical stage</lable>
                                                                    <obs id="90203" conceptId="90203"
                                                                         answerConceptIds="90033,90034,90035,90036,90293,90294,90295,90296"
                                                                         answerLabels="1,2,3,4,T1,T2,T3,T4" labelText=""/>
                                                                </div>
                                                            </div>
                                                            
                                                            <div class="row">
                                                                <div class="col-md-8">
                                                                    <label>Hep B Status</label>
                                                                    <span class="HepBStatus horizontal">
                                                                        <obs conceptId="1322" answerConceptIds="159971,90001"
                                                                             answerLabels="Tested,Not Tested" style="radio"/>
                                                                    </span>
                                                                </div>

                                                                <div class="col-md-4">
                                                                    <label>Hep B Results (if tested)</label>
                                                                    <span class="EnableDisableHepBStatus horizontal">
                                                                        <obs conceptId="1322" answerConceptIds="703,664"
                                                                             answerLabels="Negative,Positive" style="radio"/>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class ="row">
                                                        <div class="col-md-4">
                                                            <lable>Syphilis Status</lable>
                                                            <obs conceptId="99753" answerConceptIds="162848,99756,99755,99754"
                                                                 answerLabels=" No symptoms,Symptomatic Non-Reactive,Symptomatic Reactive,Symptomatic Reactive and treated" />
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>

                            <div class="tab-pane fade" id="medication">
                                <section>
                                    <div class="card">
                                        <div class="card-header">Medication</div>
                                        <div class="card-body">
                                            <h4>CTX/Dapsone</h4>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Is given CTX/Dapsone?</label>
                                                    <span class="IsTakingDapsone horizontal">
                                                        <obs conceptId="160434" answerConceptIds="1065,1066,1067"
                                                             answerLabels="Yes,No,NE" style="radio"/>
                                                    </span>
                                                </div>
                                                <div class="col-md-3 EnableDisableDapsone">
                                                    <obs conceptId="99034" labelText="No. of Pills"/>
                                                </div>
                                                <div class="col-md-3 EnableDisableDapsone">
                                                    <obs conceptId="99033" labelText="No. of Days"/>
                                                </div>
                                            </div>
                                        
                                            <h4>Fluconazole</h4>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <obs id="FluconazoleStartDate" conceptId="165280" labelText="Start Date"/>
                                                </div>
                                                <div class="col-md-3 EnableDisableFluconazole">
                                                    <obs conceptId="165281" labelText="Stop Date"/>
                                                </div>
                                                <div class="col-md-3 EnableDisableFluconazole">
                                                    <obs conceptId="165282" labelText="No. of Pills"/>
                                                </div>
                                                <div class="col-md-3 EnableDisableFluconazole">
                                                    <obs conceptId="165283" labelText="No. of Days"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">Other Meds dispensed</div>
                                        <div class="card-body">
                                            <repeat>
                                                <template>
                                                    <obsgroup groupingConceptId="160741">
                                                        <div class="row multi-drug" id="{id}-toggleContainer">
                                                            <div class="col-md-2">
                                                                <obs labelText="Drug" conceptId="1282" answerConceptSetIds="1157,1158,1159,1195,1197,5279,5839" style="autocomplete"/>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <obs labelText="Units per dose" conceptId="160856"/>
                                                            </div>
                                                            <div class="col-md-3">
                                                                <span class="long-value-select">
                                                                <obs labelText="Doses per day" conceptId="160855"/>
                                                                </span>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <obs labelText="Duration" conceptId="159368"/>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <br/>
                                                                <obs conceptId="1732"/>
                                                            </div>
                                                            <div class="col-md-1">
                                                                <div style="font-size: 25px;margin-top: 26px;">
                                                                    <a href="#" id="{id}-addEntry" class="addEntry add-more-link"><i class="icon-plus-sign"></i></a>  <a href="#" class="removeEntry remove-more-link" id="{id}-removeEntry"> <i class="icon-minus">  </i></a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </obsgroup>
                                                </template>
                                                <render id="1"/>
                                                <render id="2"/>
                                                <render id="3"/>
                                                <render id="4"/>
                                                <render id="5"/>
                                                <render id="6"/>
                                                <render id="7"/>
                                                <render id="8"/>
                                                <render id="9"/>
                                                <render id="10"/>
                                            </repeat>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">Medication</div>
                                        <div class="card-body">
                                    
                                            <h4>Adherence:</h4>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <span class="disableARTAdherence horizontal">
                                                        <obs conceptId="90221" answerConceptIds="90156,90157,90158"
                                                             answerLabels=" Good, Fair, Poor" style="radio"/>
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <h4>why Poor/Fair Adherence</h4>
                                            <div class="EnableDisableAdherenceReason checkboxGroup lablex3">
                                                <div class="row">
                                                    <div class="col-md-3">
                                                        <obs conceptId="90223" answerConceptId="90040"
                                                             answerLabel="1 - Toxicity"/>
                                                        <obs conceptId="90223" answerConceptId="90146"
                                                             answerLabel="2 - Share with others"/>
                                                        <obs conceptId="90223" answerConceptId="90147"
                                                             answerLabel="3 - Forgot"/>
                                                        <obs conceptId="90223" answerConceptId="90148"
                                                             answerLabel="4 - Felt better"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="90223" answerConceptId="90149"
                                                             answerLabel="5 - Too ill"/>
                                                        <obs conceptId="90223" answerConceptId="90150"
                                                             answerLabel="6 - Stigma"/>
                                                        <obs conceptId="90223" answerConceptId="90045"
                                                             answerLabel="7 - Drug Stock out"/>
                                                        <obs conceptId="90223" answerConceptId="90151"
                                                             answerLabel="8 - Lost pills"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="90223" answerConceptId="90152"
                                                             answerLabel="9 - Travel problems"/>
                                                        <obs conceptId="90223" answerConceptId="90051"
                                                             answerLabel="10 - Inability to pay"/>
                                                        <obs conceptId="90223" answerConceptId="90153"
                                                             answerLabel="11 - Alcohol"/>
                                                        <obs conceptId="90223" answerConceptId="90154"
                                                             answerLabel="12 - Depression"/>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <obs conceptId="90223" answerConceptId="90155"
                                                             answerLabel="13 - Pill burden"/>
                                                        <obs conceptId="90223" answerConceptId="99049"
                                                             answerLabel="14 - Lack of food"/>
                                                        <span class="enableDisable">
                                                            <span id="trigger">
                                                                <obs conceptId="90223" answerConceptId="90002"
                                                                     answerLabel="15 - Other Specify:"/>
                                                            </span>
                                                            <span id="disabled">
                                                                <obs conceptId="99125" labelText="" size="21"/>
                                                            </span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        
                                            <div class="RegimenEnableDisable1">
                                                <span class="disableARTRegimen">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <obs id="90315" conceptId="90315" labelText="Regimen:"
                                                                 answerConceptIds="99015,99016,99005,99006,164979,99039,99040,164977,99041,99042,99007,99008,99044,99043,99282,99283,99046,99017,99018,99019,99045,99284,99285,99286,99884,99885,164978,99888,163017,99887,90002"
                                                                 answerLabels="d4T-3TC-NVP,d4T-3TC-EFV,AZT-3TC-NVP,AZT-3TC-EFV,AZT-3TC-DTG,TDF-3TC-NVP,TDF-3TC-EFV,TDF-3TC-DTG,TDF-FTC-NVP,TDF-FTC-EFV,ABC-ddI(250)-LPV/r,ABC-ddI(400)-LPV/r,TDF-3TC-LPV/r,TDF-FTC-LPV/r,ZDV-ddI(250)-LPV/r,ZDV-ddI(400)-LPV/r,AZT-3TC-LPV/r,ABC-ddI-LPV/r,ABC-ddI-NFV,ABC-ddI-SQV/r,ZDV-ddI-LPV/r,AZT-ABC-LPV/r,ABC-ddI-ATV/r,AZT-3TC-ATV/r,ABC-3TC-NVP,ABC-3TC-EFV,ABC-3TC-DTG,ABC-3TC-ATV/r,ABC-3TC-LPV/r,TDF-3TC-ATV/r,Other"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <span class="RegimenEnableDisableChild1">
                                                                <obs conceptId="99126" size="18" labelText="Specify"/>
                                                            </span>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <obs conceptId="99038" labelText="No. of Pills:"/>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <obs conceptId="99036" size="5" labelText="Days:"/>
                                                        </div>
                                                    </div>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </section>
                            </div>

                            <div class="tab-pane fade" id="investigations">
                                <section>
                                    <div class="card">
                                        <div class="card-header">Investigations</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <obs conceptId="5497" dateLabel="Date:" labelText="CD4:"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <obs conceptId="730" dateLabel="Date:" labelText="CD4%:"/>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>CrAg</label>
                                                    <obs conceptId="165290" answerConceptIds="703,664,1118,1175"
                                                         answerLabels="Negative,Positive,Not Done,Not Applicable"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>RPR</label>
                                                    <obs conceptId="165289" answerConceptIds="1228,1229,1118,1175"
                                                         answerLabels="Reactive,Non-Reactive,Not Done,Not Applicable"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>TB LAM</label>
                                                    <obs conceptId="165291" answerConceptIds="703,664,1118,1175"
                                                         answerLabels="Positive,Negative,Not Done,Not Applicable"/>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Gene Xpert</label>
                                                    <obs conceptId="162202" answerConceptIds="664,703,1118,1175"
                                                         answerLabels="Negative,Positive,Not Done,Not Applicable"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Microscopy</label>
                                                    <obs conceptId="304" answerConceptIds="703,664,1118,1175"
                                                         answerLabels="Negative,Positive,Not Done,Not Applicable"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>X-Ray</label>
                                                    <obs conceptId="165292" answerConceptIds="165293,165294,1118,1175"
                                                         answerLabels="suggestive,Non-suggestive,Not Done,Not Applicable"/>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <label>Other Investigations</label>
                                                    <obs conceptId="99114" style="textarea"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">Viral Load</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Date Viral Load Taken</label>
                                                    <obs id="date-viral-load-taken" conceptId="163023" allowFutureDates="false"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Viral Load Results</label>
                                                    <obs id="viral-load-results-qualitative" conceptId="1305" answerConceptIds="1301,1306,1304"
                                                         answerLabels="Detected,Not Detected, Sample Rejected"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Viral Load (copies/ml)</label>
                                                    <obs id="viral-load-results-copies" conceptId="856"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Viral Load Status</label>
                                                    <input id="viral-load-status" type="text" disabled="disabled"/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header">DSDM</div>
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="hidden">
                                                    <uiInclude provider="aijar" fragment="patientStability"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Duration on ART (Months since baseline)</label>
                                                    <obs id="99024" conceptId="99024" />
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Months on current regimen</label>
                                                    <obs id="99025" conceptId="99025" />
                                                </div>
                                                <div class="col-md-3">
                                                    <label>DSDM Patient Categorization</label>
                                                    <obs id="165144" conceptId="165144" answerConceptIds="90003,90004" answerLabels="Yes,No"
                                                         defaultValue="90004"/>
                                                </div>
                                                <div class="col-md-3">
                                                    <label>DSDM Approach</label>
                                                    <obs id="165143" conceptId="165143" answerConceptIds="165138,165140,165139,165142,165141"
                                                         answerLabels="FBIM,FBG,FTR,CDDP,CCLAD" required="required"/>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>Visit Type</label>
                                                    <obs conceptId="160288" answerConceptIds="164969,165284" answerLabels="Drug Refill Only, Clinical Assessment" />
                                                </div>
                                            </div>                                        
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</htmlform>